#!/usr/bin/env php
<?php

$files = array(
  __DIR__ . '/../../../autoload.php',
  __DIR__ . '/../../autoload.php',
  __DIR__ . '/../vendor/autoload.php',
  __DIR__ . '/vendor/autoload.php'
);

foreach ($files as $file) {
  if (file_exists($file)) {
    require_once $file;
    break;
  }
}

function rglob($pattern, $flags = 0) {
  $files = glob($pattern, $flags); 
  foreach (glob(dirname($pattern).'/*', GLOB_ONLYDIR|GLOB_NOSORT) as $dir) {
    $files = array_merge($files, rglob($dir.'/'.basename($pattern), $flags));
  }
  return $files;
}

if (count($argv) > 1) {
  $files = array_slice($argv, 1);
} else {
  $files = rglob(getcwd() . "/specs/*Spec.php");
}

$files = array_merge(
  $files, 
  rglob(getcwd() . "/specs/*SharedContext.php")
);

(new Speckl\Runner($files))->run();
